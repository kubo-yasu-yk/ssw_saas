# ç‰¹å®šæŠ€èƒ½ åœ¨ç•™è³‡æ ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

ç‰¹å®šæŠ€èƒ½å¤–å›½äººã®åœ¨ç•™è³‡æ ¼ç®¡ç†ã‚’åŠ¹ç‡åŒ–ã™ã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚Vite + React + TypeScript + Tailwind ã§æ§‹æˆã•ã‚ŒãŸãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ã€Supabaseã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã—ã¦ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚  
ãƒ‡ãƒ—ãƒ­ã‚¤ã®å†å®Ÿè¡ŒãŒå¿…è¦ãªå ´åˆã¯ã€`main` ãƒ–ãƒ©ãƒ³ãƒã«è»½å¾®ãªå¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ push ã™ã‚‹ã ã‘ã§ Vercel ã® Production ãŒè‡ªå‹•ã§å†ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã™ã€‚

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
.
â”œâ”€ README.md
â”œâ”€ docs/                      # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚  â”œâ”€ setup.md                # Supabaseã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †æ›¸
â”‚  â”œâ”€ implementation.md       # å®Ÿè£…ãƒ—ãƒ©ãƒ³
â”‚  â””â”€ codex-review.md         # ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼
â”œâ”€ frontend/                  # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä¸€å¼ï¼ˆVite ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰
â”‚  â””â”€ src/
â”‚     â”œâ”€ api/                 # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
â”‚     â”‚  â”œâ”€ *.service.ts      # APIã‚µãƒ¼ãƒ“ã‚¹ï¼ˆCRUDæ“ä½œï¼‰
â”‚     â”‚  â””â”€ mappers/          # ãƒ‡ãƒ¼ã‚¿å¤‰æ›å±¤ï¼ˆsnake_case â‡” camelCaseï¼‰
â”‚     â”œâ”€ services/            # ã‚¤ãƒ³ãƒ•ãƒ©å±¤
â”‚     â”‚  â””â”€ supabase/         # Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ»å‹å®šç¾©
â”‚     â”œâ”€ state/               # çŠ¶æ…‹ç®¡ç†å±¤
â”‚     â”‚  â”œâ”€ app/              # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
â”‚     â”‚  â”œâ”€ auth/             # èªè¨¼çŠ¶æ…‹
â”‚     â”‚  â””â”€ shared/           # å…±é€šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆapiExecutorï¼‰
â”‚     â”œâ”€ components/          # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚     â”œâ”€ pages/               # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚     â”œâ”€ types/               # å‹å®šç¾©
â”‚     â”œâ”€ utils/               # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚     â””â”€ mocks/               # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
â”œâ”€ supabase/                  # Supabaseãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒãƒ»ãƒãƒªã‚·ãƒ¼
â”‚  â”œâ”€ schema.sql              # ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã¨ãƒˆãƒªã‚¬ãƒ¼ï¼ˆçµ±åˆç‰ˆï¼‰
â”‚  â”œâ”€ rls_policies.sql        # Row Level Securityãƒãƒªã‚·ãƒ¼ï¼ˆçµ±åˆç‰ˆï¼‰
â”‚  â”œâ”€ seed.sql                # åˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆé–‹ç™ºç”¨ï¼‰
â”‚  â”œâ”€ schema/                 # ã‚¹ã‚­ãƒ¼ãƒå€‹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆé–‹ç™ºç”¨ï¼‰
â”‚  â””â”€ policies/               # ãƒãƒªã‚·ãƒ¼å€‹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆé–‹ç™ºç”¨ï¼‰
â””â”€ vercel.json                # Vercel ç”¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°/ãƒ“ãƒ«ãƒ‰è¨­å®š
```

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: React 18 + TypeScript + Vite
- **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°**: Tailwind CSS + shadcn/ui
- **çŠ¶æ…‹ç®¡ç†**: React Context API
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Supabase (PostgreSQL + Auth + Storage)
- **èªè¨¼**: Supabase Auth
- **ãƒ•ã‚©ãƒ¼ãƒ **: React Hook Form + Zod
- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆServiceå±¤ / Mapperå±¤ / Stateå±¤ï¼‰

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€**ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ã®åŸå‰‡ã«åŸºã¥ã„ãŸéšå±¤æ§‹é€ ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

### ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Presentation Layer (pages, components) â”‚  â† UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  State Layer (state/)                   â”‚  â† çŠ¶æ…‹ç®¡ç†ãƒ»Context
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Business Logic Layer (api/)            â”‚  â† ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚  - *.service.ts                         â”‚
â”‚  - mappers/ (ãƒ‡ãƒ¼ã‚¿å¤‰æ›)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Infrastructure Layer (services/)       â”‚  â† å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆ
â”‚  - supabase/ (DBæ¥ç¶š)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å„å±¤ã®è²¬å‹™

1. **Business Logic Layer** (`api/`)
   - CRUDæ“ä½œã®å®Ÿè£…
   - ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®é©ç”¨
   - ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ãƒ»åŠ å·¥

2. **Mapper Layer** (`api/mappers/`)
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å‹ â‡” ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‹ã®å¤‰æ›
   - snake_case â‡” camelCase ã®å¤‰æ›
   - å‹å®‰å…¨ãªå¤‰æ›å‡¦ç†

3. **Infrastructure Layer** (`services/`)
   - Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ç®¡ç†
   - å¤–éƒ¨APIã¨ã®é€šä¿¡
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å‹å®šç¾©

4. **State Layer** (`state/`)
   - React Contextã«ã‚ˆã‚‹çŠ¶æ…‹ç®¡ç†
   - å…±é€šãƒ­ã‚¸ãƒƒã‚¯ï¼ˆ`apiExecutor`ï¼‰
   - ã‚ªãƒ—ãƒ†ã‚£ãƒŸã‚¹ãƒ†ã‚£ãƒƒã‚¯UIãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

- **Repository Pattern**: `*.service.ts` ãŒãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã‚’æŠ½è±¡åŒ–
- **Mapper Pattern**: `mappers/` ã§ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã‚’åˆ†é›¢
- **Strategy Pattern**: `apiExecutor` ã§å®Ÿè¡Œæˆ¦ç•¥ã‚’çµ±ä¸€
- **Dependency Injection**: Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’æ³¨å…¥

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **[ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †](./docs/setup.md)** - Supabaseãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®è©³ç´°ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †
- **[ç’°å¢ƒè¨­è¨ˆã‚¬ã‚¤ãƒ‰](./docs/environment-setup.md)** - é–‹ç™ºï¼æœ¬ç•ªã® Supabaseãƒ»Vercel æ§‹æˆãƒãƒªã‚·ãƒ¼

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. Supabaseãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

è©³ç´°ãªæ‰‹é †ã¯ **[docs/setup.md](./docs/setup.md)** ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**æ¦‚è¦**:
1. Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
2. `supabase/schema.sql` ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã‚’ä½œæˆ
3. `supabase/rls_policies.sql` ã§Row Level Securityã‚’è¨­å®š
4. `supabase/seed.sql` ã§åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥
5. èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä½œæˆ

### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
cd frontend
npm install
```

### 3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`frontend/env.example` ã‚’ `frontend/.env.local` ã«ã‚³ãƒ”ãƒ¼ã—ã¦ç·¨é›†ï¼š

```bash
cp frontend/env.example frontend/.env.local
```

`.env.local` ã«ä»¥ä¸‹ã‚’è¨­å®šï¼š

```bash
VITE_SUPABASE_URL=https://your-project-id.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key-here
```

### 4. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```bash
cd frontend
npm run dev
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `http://localhost:5173` ã«ã‚¢ã‚¯ã‚»ã‚¹

## ãƒ“ãƒ«ãƒ‰

```
cd frontend
npm run build
npm run preview
```

## ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆVercelï¼‰

### 1. Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æº–å‚™

æœ¬ç•ªç’°å¢ƒç”¨ã®Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹ã‹ã€é–‹ç™ºç’°å¢ƒã¨åŒã˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨

### 2. Vercelã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

1. ãƒªãƒã‚¸ãƒˆãƒªã‚’GitHubç­‰ã«push
2. Vercelã§ **New Project** â†’ ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
3. Framework Preset: **Vite**ï¼ˆè‡ªå‹•æ¤œå‡ºï¼‰
4. Build Command: `npm --prefix frontend run build`
5. Output Directory: `frontend/dist`
6. **Environment Variables** ã«ä»¥ä¸‹ã‚’è¨­å®šï¼š
   - `VITE_SUPABASE_URL`: Supabase Project URL
   - `VITE_SUPABASE_ANON_KEY`: Supabase Anon Key
7. **Deploy** ã‚’ã‚¯ãƒªãƒƒã‚¯

SPA ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç”¨ã« `vercel.json` ã§ãƒ«ãƒ¼ãƒˆã‚’ `/` ã«ãƒªãƒ©ã‚¤ãƒˆã—ã¦ã„ã¾ã™ã€‚

## ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ï¼ˆé–‹ç™ºç’°å¢ƒï¼‰

åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§ä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼š
- email: `admin@example.com`
- password: `password123` ï¼ˆã¾ãŸã¯ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚ã«è¨­å®šã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰

## ä¸»ãªæ©Ÿèƒ½

### èªè¨¼ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
- Supabase Authã«ã‚ˆã‚‹èªè¨¼ï¼ˆãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†
- ä¼šç¤¾ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿åˆ†é›¢ï¼ˆRow Level Securityï¼‰

### ç‰¹å®šæŠ€èƒ½å¤–å›½äººç®¡ç†
- å¤–å›½äººãƒ‡ãƒ¼ã‚¿ã®CRUDæ“ä½œ
- åœ¨ç•™è³‡æ ¼æƒ…å ±ã®ç®¡ç†
- å€‹äººæƒ…å ±ã®å®‰å…¨ãªä¿å­˜

### æ›¸é¡ç®¡ç†
- åœ¨ç•™è³‡æ ¼èªå®šè¨¼æ˜æ›¸äº¤ä»˜ç”³è«‹
- åœ¨ç•™æœŸé–“æ›´æ–°è¨±å¯ç”³è«‹
- åœ¨ç•™è³‡æ ¼å¤‰æ›´è¨±å¯ç”³è«‹
- å®šæœŸé¢è«‡å ±å‘Šæ›¸
- éšæ™‚å±Šå‡ºï¼ˆé€€è·ï¼‰å ±å‘Š
- æ›¸é¡ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»PDFå‡ºåŠ›ï¼ˆæº–å‚™ä¸­ï¼‰

### ä¼šç¤¾æƒ…å ±ç®¡ç†
- å—å…¥æ©Ÿé–¢æƒ…å ±ã®ç™»éŒ²ãƒ»æ›´æ–°
- ç™»éŒ²æ”¯æ´æ©Ÿé–¢æƒ…å ±ã®ç®¡ç†

### ãã®ä»–
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆçµ±è¨ˆæƒ…å ±ï¼‰
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ­ã‚°
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿åŒæœŸ
- ã‚ªãƒ—ãƒ†ã‚£ãƒŸã‚¹ãƒ†ã‚£ãƒƒã‚¯UI
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹æˆ

### ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§

| ãƒ†ãƒ¼ãƒ–ãƒ« | èª¬æ˜ | å¯¾å¿œã‚µãƒ¼ãƒ“ã‚¹ |
|---------|------|-------------|
| `companies` | å—å…¥æ©Ÿé–¢æƒ…å ± | `company.service.ts` |
| `foreigners` | ç‰¹å®šæŠ€èƒ½å¤–å›½äººæƒ…å ± | `foreigners.service.ts` |
| `documents` | ç”³è«‹æ›¸é¡ | `documents.service.ts` |
| `activity_logs` | ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ­ã‚° | `activity-logs.service.ts` |
| `profiles` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« | `AuthContext` |

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- **Row Level Security (RLS)**: å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã§æœ‰åŠ¹åŒ–
- **ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œ**: ä¼šç¤¾ã”ã¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†é›¢
- **èªè¨¼**: Supabase Authï¼ˆJWT ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰

è©³ç´°ã¯ `supabase/schema.sql` ãŠã‚ˆã³ `supabase/rls_policies.sql` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ã‚³ãƒ¼ãƒ‰ä¾‹

### ã‚µãƒ¼ãƒ“ã‚¹ã®ä½¿ã„æ–¹

```typescript
// api/foreigners.service.ts ã‚’ä½¿ç”¨
import { getForeigners, createForeigner } from '@api/foreigners.service'

// å¤–å›½äººä¸€è¦§ã‚’å–å¾—
const foreigners = await getForeigners()

// æ–°è¦ä½œæˆ
const newForeigner = await createForeigner({
  companyId: 'xxx',
  name: 'ç”°ä¸­ å¤ªéƒ',
  // ...
})
```

### Mapperã®ä½¿ã„æ–¹

```typescript
// api/mappers/foreigners.ts
import { mapForeignerRow } from '@api/mappers/foreigners'

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å‹ â†’ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‹
const foreigner: Foreigner = mapForeignerRow(dbRow)
```
