# MVP追加機能 タスク一覧

`requirements.md` と `design.md` に基づき、機能開発を実施するためのタスクを整理した。チェックリスト形式で担当割り当てや進捗管理に利用する。  
実装順序は以下の通りに進めることを想定する。

1. プロジェクト準備
2. 期限ドリブンタスクボード（バックエンド設定 → フロント実装 → QA）
3. 届出フロー進捗トラッカー（バックエンド → フロント → QA）
4. 証憑アップロード管理（バックエンド → フロント → QA）
5. リリース準備

## 0. プロジェクト準備
- [ ] 関係者レビュー会で仕様・設計の最終確認を実施
- [ ] スケジュールと担当（FE/BE/QA）を決定、チケット発行

## 1. 期限ドリブンタスクボード
### 1.1 バックエンド
- [ ] 期限計算に必要な `documents` / `foreigners` クエリを整理し、Supabase から直接取得できるよう型定義を作成
- [ ] ビューや RPC を作成せず、クライアント集計で利用できるインデックス（必要なら単純なインデックス追加）を検討
- [ ] `AppStateContext` 用の API ラッパーを実装（fetch・集計ロジックを共通化）

### 1.2 フロントエンド
- [ ] `TaskBoardCard` コンポーネント実装（残日数カラーリング含む）
- [ ] ダッシュボードでカードをレンダリングし、CTA リンクを設定
- [ ] 取得エラー時のリトライ UI を実装

### 1.3 QA / ドキュメント
- [ ] 残日数境界値テスト（8日→通常、7日以内→警告、3日以内→危険）
- [ ] ユーザーガイド更新（タスクボードの見方）

## 2. 届出フロー進捗トラッカー
### 2.1 バックエンド
- [ ] `documents` に `progress_state JSONB` 列を追加（マイグレーション）
- [ ] 既存レコードへ初期ステップデータを投入

### 2.2 フロントエンド
- [ ] `ProgressSteps` コンポーネント実装（ステップ表示・状態保存）
- [ ] 定期届出フォームへ組み込み、完了条件ロジック実装
- [ ] 在留更新フォームへ組み込み、完了条件ロジック実装
- [ ] ステップ完了後に編集制限を通知するモーダル実装
- [ ] タスクボード状態更新との連携を実装

### 2.3 QA / ドキュメント
- [ ] ステップ遷移テスト（完了→未完了→完了）
- [ ] JSONB 保存・復元のユニットテスト
- [ ] ユーザードキュメントにステップ説明を追加

## 3. 証憑アップロード管理
### 3.1 バックエンド
- [ ] Supabase Storage に `documents-evidence` バケットを作成
- [ ] RLS ポリシーを設定（`company_id` マッチのみ read/write 可）
- [ ] `attachments` テーブルを作成し、FK・インデックスを設定

### 3.2 フロントエンド
- [ ] `EvidenceUploader` コンポーネント実装（バリデーション、アップロード/削除）
- [ ] 定期届出フォームに証憑セクションを追加
- [ ] 在留更新フォームに証憑セクションを追加
- [ ] 再アップロード時に進捗を未完了へ戻す処理を実装

### 3.3 QA / ドキュメント
- [ ] ファイルサイズ・拡張子の自動テスト
- [ ] 他テナントからのアクセス遮断テスト
- [ ] 証憑取り扱いガイドライン更新

## 4. リリース準備
- [ ] DB マイグレーションと Storage 変更の適用手順書作成
- [ ] リリースノート草案作成（主要改善点・注意事項）
- [ ] 将来対応項目（CSV 入出力・通知機能等）をバックログに登録
